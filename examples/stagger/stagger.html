<!DOCTYPE html>
<html>
  <head>
    <title>Stagger</title>
    <script type="text/javascript" src="../../d3.js"></script>
    <script type="text/javascript" src="../../d3.layout.js"></script>
    <style type="text/css">

body {
  font: 10px sans-serif;
}

svg {
  display: block;
  margin: auto;
}

    </style>
  </head>
  <body>
    <script type="text/javascript">

var n = 20,
    m = 8,
    w = 1200,
    h = n * 30,
    x = d3.scale.linear().range([120, w]),
    y = d3.scale.ordinal().domain(d3.range(n)).rangeRoundBands([0, h], .05),
    z = d3.scale.category10();

var data = d3.range(n).map(function(i) {
  return d3.range(m).map(function() { return step((n - i) / n); });
});

var stagger = d3.layout.stagger();

var svg = d3.select("body").append("svg:svg")
    .attr("width", w)
    .attr("height", h);

var g = svg.selectAll("g")
    .data(data)
  .enter().append("svg:g")
    .attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });

g.append("svg:text")
    .attr("y", y.rangeBand() / 2)
    .attr("x", x(0) - 6)
    .attr("text-anchor", "end")
    .attr("dy", ".35em")
    .text(function(d, i) { return i; });

g.append("svg:rect")
    .attr("x", x(0))
    .attr("width", x(1) - x(0))
    .attr("height", y.rangeBand())
    .style("fill", "#eee");

g.selectAll("line")
    .data(function(d) { return stagger(d); })
  .enter().append("svg:line")
    .attr("x1", function(d) { return x(d.x); })
    .attr("x2", function(d) { return x(d.x + d.dx); })
    .attr("y1", function(d) { return d.y * 3 + 3; })
    .attr("y2", function(d) { return d.y * 3 + 3; })
    .style("stroke", function(d, i) { return z(i & 7); })
    .style("stroke-width", "2px");

// Generate a random step.
function step(w) {
  return {x: Math.random(), dx: (Math.abs(normal()) + 1) * w / 4};
}

// Sample from a normal distribution with mean 0, stddev 1.
function normal() {
  var x = 0, y = 0, rds, c;
  do {
    x = Math.random() * 2 - 1;
    y = Math.random() * 2 - 1;
    rds = x * x + y * y;
  } while (rds == 0 || rds > 1);
  c = Math.sqrt(-2 * Math.log(rds) / rds); // Box-Muller transform
  return x * c; // throw away extra sample y * c
}

    </script>
  </body>
</html>
